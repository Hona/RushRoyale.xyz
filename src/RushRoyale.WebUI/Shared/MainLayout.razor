@inherits LayoutComponentBase

@inject AuthenticationClient AuthenticationClient
@inject NavigationManager NavigationManager
@inject HttpClient HttpClient

<MudLayout>
    <MudAppBar Elevation="1">
        <MudText Typo="Typo.h5" Class="ml-3">
            RushRoyale.xyz
        </MudText>
        <MudSpacer />
        <AuthorizeView>
            <Authorized>
                @context.User.Identity?.Name
            </Authorized>
            <NotAuthorized>
                <MudButton IconColor="Color.Inherit" EndIcon="@Icons.Custom.Brands.Discord" Size="Size.Large" Color="Color.Inherit" OnClick="LoginCallback">
                    Login
                </MudButton>
            </NotAuthorized>
        </AuthorizeView>
    </MudAppBar>
    <MudMainContent>
        <MudContainer MaxWidth="MaxWidth.Large" Class="mt-4">
            @Body
        </MudContainer>
    </MudMainContent>
</MudLayout>

<MudThemeProvider IsDarkMode/>
<MudDialogProvider/>
<MudSnackbarProvider/>

@code {
    private void LoginCallback()
    {
        var relativeUri = "/api/Authentication/login?returnUrl=" + Uri.EscapeDataString(NavigationManager.Uri);
        var loginEndpoint = new Uri(HttpClient.BaseAddress, relativeUri);
        
        NavigationManager.NavigateTo(loginEndpoint.ToString(), true);
    }
}